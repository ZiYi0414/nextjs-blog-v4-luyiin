---
title: 'è§‚å¯Ÿè€…æ¨¡å¼åº”ç”¨-Observer Pattern'
description: 'å¯¹è§‚å¯Ÿè€…æ¨¡å¼åœ¨JavaScriptä¸­åº”ç”¨çš„å­¦ä¹ ç¬”è®°ï¼Œé¡ºä¾¿å®ç°äº†ğŸ®ğŸä¸»æ’­å…³æ³¨ç³»ç»Ÿï¼'
publishedAt: '2022-05-14'
tags: 'Note'
---

## è§‚å¯Ÿè€…æ¨¡å¼ Observer Pattern

ä½¿ç”¨è¢«è§‚å¯Ÿå¯¹è±¡åœ¨å‘ç”Ÿäº‹ä»¶æˆ– balabala..çš„æ—¶å€™é€šçŸ¥è®¢é˜…è€…ï¼Œä¹Ÿå°±æ˜¯`è§‚å¯Ÿè€…`è§‚å¯Ÿ`è¢«è§‚å¯Ÿè€…`ã€‚

Use `observables` to notify `subscribers` when an event occurs

ä½¿ç”¨`Observer Pattern`ï¼Œæˆ‘ä»¬å¯ä»¥å°†ä¸€äº›å¯¹è±¡`è§‚å¯Ÿè€…`è®¢é˜…åˆ°å…¶ä»–å¯¹è±¡`å¯è§‚å¯Ÿ`å¯¹è±¡ã€‚æ¯å½“äº‹ä»¶å‘ç”Ÿï¼Œæ‰€æœ‰`è¢«è§‚å¯Ÿ`ï¼Œæˆ–ç§°ä¸º`å¯è§‚å¯Ÿ`çš„å¯¹è±¡éƒ½ä¼šé€šçŸ¥æ‰€æœ‰å·²ç»è®¢é˜…çš„å¯¹è±¡`è§‚å¯Ÿè€…`

<hr style={{ margin: '15px auto' }} />

ä¸€ä¸ªå¯è§‚å¯Ÿçš„å¯¹è±¡é€šå¸¸åŒ…å« 3 ä¸ªé‡è¦éƒ¨åˆ†ï¼šğŸ‘‡

- `observers`: ä¸€ç»„è§‚å¯Ÿè€…ï¼Œå½“å®šä¹‰çš„äº‹ä»¶å‘ç”Ÿå°†å¾—åˆ°é€šçŸ¥ (å®¶äººä»¬)
- `subscribe()`: ä¸€ä¸ªå°†è§‚å¯Ÿè€…æ·»åŠ åˆ°è®¢é˜…åˆ—è¡¨ä¸­çš„æ–¹æ³• ï¼ˆå…³æ³¨ä¸»æ’­ä¸è¿·è·¯ï¼‰
- `unsubscribe()`: ä¸€ä¸ªå°†è§‚å¯Ÿè€…ä»è®¢é˜…åˆ—è¡¨ä¸­åˆ é™¤çš„æ–¹æ³• (å–å…³ï¼)
- `notify()`: ä¸€ä¸ªåœ¨å®šä¹‰äº‹ä»¶å‘ç”Ÿé€šçŸ¥æ‰€æœ‰è§‚å¯Ÿè€…çš„æ–¹æ³• (æ¨é€ï¼)

Perfect, lets create an observable! An ez way of creating one, is by using an ES6 class.

ç‰›æ°ï¼Œç°åœ¨æä¸€ä¸ª ğŸ®ğŸ ä¸»æ’­å…³æ³¨ç³»ç»Ÿç©ç©ï¼Œå½“ç„¶æ˜¯ä½¿ç”¨æˆ‘æœ€çˆ±çš„ JS äº† ğŸ˜„ã€‚mmp

```JS
class Observable {
  constructor() {
    // ä¸€ç»„å®¶äººåˆ—è¡¨
    this.observers = []
  }

  subscribe(func) {
    // ç‚¹ç‚¹å…³æ³¨ï¼Œå…³æ³¨ä¸»æ’­ä¸è¿·è·¯äº†å—·è€é“ã€‚
    this.observers.push(func)
  }

  unsubscribe(func) {
    // è¿™ä¸»æ’­ä¹Ÿå¤ªè…Šé¸¡äº†ï¼Œå–å…³äº†ã€‚
    this.observers = this.observers.filter( observer => observer !== func)
  }

  notify(data) {
    // å®¶äººä»¬ï¼Œå¼€æ’­äº†ï¼Œä»Šå¤©ä¾æ—§æ˜¯ç§˜åˆ¶...åŒ…
    this.observers.forEach(observer => observer(data))
  }
}

```

Awesome!ï¼Œäºè´¼ã€‚ æˆ‘è¶…ï¼Œå®Œç¾ã€‚ç°åœ¨å·²ç»å®ç°äº†åŸºæœ¬çš„å…³æ³¨å’Œå–æ¶ˆåŠŸèƒ½ï¼Œä»¥åŠä¸»æ’­å¼€æ’­é€šçŸ¥åŠŸèƒ½äº†å“ˆã€‚

é‚£ä¹ˆå¥½ï¼Œæ¥ä¸‹æ¥æŠŠä»–ä»‹å…¥åˆ°æˆ‘ä»¬çš„ç‰›é©¬ç›´æ’­é¡µé¢é‡Œå§ã€‚ï¼ˆå½“ç„¶ï¼Œåªæœ‰ä¸€ä¸ªæŒ‰é’®å’Œæ¶ˆæ¯é€šçŸ¥ç»„ä»¶ï¼‰

```JS
export default function App() {
  retrun (
    <div classNam="App">
      <Button>å…³æ³¨äº†å—·</Button>
      <Button>å–å…³å–å…³ï¼</Button>
      // åˆ«é—®ä¸ºå•¥æ˜¯ä¸¤ä¸ªæŒ‰é’®å“ˆã€‚æˆ‘é”¤ä½ å“¦ğŸ˜„
    </div>
  )
}

```

æ¥ä¸‹æ¥å’‹åŠå‘¢ï¼Œå®¶äººä»¬è¿›åˆ°ç›´æ’­é—´ï¼Œå‘ç° ğŸ® é©¬ä¸»æ’­æœ‰ç‚¹æ„æ€ç‚¹å…³æ³¨äº†ï¼

æˆ‘ä»¬æƒ³è¦è·Ÿè¸ª `ç”¨æˆ·` ä¸åº”ç”¨çš„äº¤äº’ã€‚å½“ç”¨æˆ·ç‚¹å‡»å…³æ³¨ï¼Œæˆ‘ä»¬å¸Œæœ›ç”¨æ—¶é—´æˆ³è®°å½•è¯¥äº‹ä»¶ï¼Œé™¤äº†è®°å½•è¿™ä»¶äº‹ï¼Œæˆ‘ä»¬éœ€è¦åœ¨å…¬å±ä¸Šæ˜¾ç¤ºå‡ºæ¥æœ‰å®¶äººç‚¹å…³æ³¨äº†ï¼

ok é‚£ä¹ˆåœ¨ä¹‹å‰çš„åŸºç¡€ä¹‹ä¸ŠåŠ ä¸Šå…³æ³¨çš„æ–¹æ³•å’Œå…¬å±é€šçŸ¥çš„æ–¹æ³•å§ï¼

```JS
// è¿™ä¸ªæ˜¯ä¸€ä¸ªè™šæ‹Ÿçš„ç›´æ’­å…¬å±æ–‡å­—ç»„ä»¶
import { Message, message } from 'Message-System'

// è®°å½•å…³æ³¨æ—¶é—´
const logger =  (data) => {
  console.log(`${Date.now()} ${data}`)
}

// å…¬å±é€šçŸ¥ï¼
const publicNotify = (data) => {
  message(data)
}


export default function App() {
  retrun (
    <div classNam="App">
      <Button>å…³æ³¨äº†å—·</Button>
      <Button>å–å…³å–å…³ï¼</Button>
      <Message />
    </div>
  )
}

```

å¥½çš„ï¼Œç°åœ¨å·²ç»æœ‰äº†å…³æ³¨å’Œé€šçŸ¥çš„èƒ½åŠ›ï¼Œä½†æ˜¯æˆ‘ä»¬çš„ç‰›é©¬ä¸»æ’­å…³æ³¨ç³»ç»Ÿè¿˜æ²¡æœ‰å…³è”ä¸Šï¼

`logger`å’Œ `publicNotify` å‡½æ•°éœ€è¦æˆä¸ºè§‚å¯Ÿè€…ï¼Œå¿…é¡»è®©ä»–å…³æ³¨ä¸»æ’­å•Šï¼ ä½¿ç”¨ `subscribe` å…³æ³¨ï¼

```JS
import { Message, message } from 'Message-System'

const logger =  (data) => {
  console.log(`${Date.now()} ${data}`)
}

const publicNotify = (data) => {
  message(data)
}

// è®¢é˜…äº† å®¶äººä»¬
observable.subscribe(logger)
observable.subscribe(publicNotify)

export default function App() {
  retrun (
    <div classNam="App">
      <Button>å…³æ³¨äº†å—·</Button>
      <Button>å–å…³å–å…³ï¼</Button>
      <Message />
    </div>
  )
}

```

å¥½ï¼Œç°åœ¨æ¯å½“äº‹ä»¶å‘ç”Ÿçš„æ—¶å€™ï¼Œè¿™ä¸ªå‡½æ•°å°±ä¼šæ”¶åˆ°é€šçŸ¥äº†ï¼ç°åœ¨æˆ‘ä»¬åªéœ€è¦å®ç°é€šçŸ¥ observable çš„å‡½æ•°å°± ok äº†ï¼š`handleFocus` å’Œ `handleCancel`ï¼Œ ç„¶åè¿™äº›å‡½æ•°çš„å†…éƒ¨è°ƒç”¨ `notify` å¹¶ä¼ é€’è§‚å¯Ÿè€…éœ€è¦æ¥æ”¶çš„æ•°æ®å°± ok

```JS
import { Message, message } from 'Message-System'

const logger =  (data) => {
  console.log(`${Date.now()} ${data}`)
}

const publicNotify = (data) => {
  message(data)
}

// è®¢é˜…äº† å®¶äººä»¬
observable.subscribe(logger)
observable.subscribe(publicNotify)

export default function App() {
 function handleFocus() {
    observable.notify("å®¶äººä»¬ æ„Ÿè°¢å…³æ³¨äº†å—·ï¼!");
  }

  function handleCancel() {
    observable.notify("æ²¡å•¥æ„æ€ï¼Œå–å…³äº†!");
  }


  retrun (
    <div classNam="App">
      <Button onClick={handleFocus}>å…³æ³¨äº†å—·</Button>
      <Button onClick={handleCancel}>å–å…³å–å…³ï¼</Button>
      <Message />
    </div>
  )
}

```

ok äº†ï¼ å…¨ä½“ç›®å…‰çœ‹å‘æˆ‘ï¼ æˆ‘å®£å¸ƒä¸ªäº‹å„¿ã€‚ ç‰›é©¬ç›´æ’­å¹³å°çš„å…³æ³¨é€šçŸ¥ç³»ç»Ÿå®Œæˆäº†ï¼ ğŸ·ï¼Œ `handleFocus` è°ƒç”¨ notify å¹¶ä¼ å…¥ç›¸åº”çš„ dataï¼Œ ä¹‹åè§‚å¯Ÿè€…é€šçŸ¥è®¢é˜…è€… æ‰“å°æ—¶é—´å¹¶ä¸”è¾“å‡º dataï¼Œ å¹¶ä¸”åœ¨å…¬å±å¼¹å‡ºå…³æ³¨æ–‡å­—ï¼

æ¯å½“ç”¨æˆ·ç‚¹å‡» `å…³æ³¨` æˆ–æ˜¯ `å–å…³` ï¼Œ`logger`å’Œ `publicNotify` éƒ½ä¼šè¿›è¡Œè§¦å‘ï¼Œå¹¶ä¸”è·å¾—ä¸åŒçš„ data æ‰§è¡Œä¸åŒçš„æ“ä½œã€‚

å“Ÿå‘µï¼Œæœ‰äººè¯´äº†ã€‚è¿™å•¥å•Šï¼Œè´¹è€åŠ²äº†ã€‚æˆ‘ç›´æ¥åœ¨å…³æ³¨å–å…³çš„åœ°æ–¹è°ƒé€šçŸ¥ç»„ä»¶ä¸è¡Œå—ï¼Ÿ

~~ä½ é—®æˆ‘ï¼Ÿï¼ æˆ‘æœˆè–ª 3K ä½ é—®æˆ‘ï¼ï¼Ÿ~~

## ä¼˜ç‚¹

ä½¿ç”¨è§‚å¯Ÿè€…æ¨¡å¼å¯ä»¥å¼ºåˆ¶ `å…³æ³¨ç‚¹åˆ†ç¦»` ä¹Ÿå°±æ˜¯ å•ä¸€èŒè´£åŸåˆ™ã€‚è§‚å¯Ÿè€…å¯¹è±¡ä¸è¢«è§‚å¯Ÿè€… æ²¡æœ‰ç›´æ¥è”ç³»ï¼Œå¯ä»¥éšæ—¶è§£é™¤è€¦åˆã€‚è¢«è§‚å¯Ÿå¯¹è±¡åªè´Ÿè´£ç›‘è§†äº‹ä»¶ã€‚è€Œè§‚å¯Ÿè€…ç›´æ¥æ”¶å¤„ç†æ”¶åˆ°çš„æ•°æ®ã€‚

Using the observer pattern is a great way to enforce `separation of concerns` and the single-responsiblity principle. The observer objects arenâ€™t tightly coupled to the observable object, and can be (de)coupled at any time. The observable object is responsible for monitoring the events, while the observers simply handle the received data.

## ç¼ºç‚¹

å¦‚æœè§‚å¯Ÿè€…å˜å¾—è¿‡äºå¤æ‚ï¼Œåœ¨é€šçŸ¥æ‰€æœ‰è®¢é˜…çš„æ—¶å€™ä¼šé€ æˆä¸€äº›æ€§èƒ½é—®é¢˜ã€‚

## References

[Patterns.dev](https://www.patterns.dev/posts/observer-pattern/)
